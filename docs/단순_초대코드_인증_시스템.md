# 간단한 초대코드 기반 인증 시스템

## 개요

복잡한 나이 인증, JWT, 비밀번호, 이메일 인증을 모두 제거하고 **초대코드 기반의 단순한 시스템**으로 변경했습니다.

## 핵심 원칙

1. **즉시 가입**: 초대코드 + 닉네임만으로 즉시 가입
2. **모든 서비스 접근**: 가입 즉시 모든 서비스 이용 가능
3. **랭크 기반 제어**: VIP/PREMIUM/STANDARD 랭크로 서비스 레벨 관리

## 사용자 플로우

```
초대코드 입력 → 닉네임 설정 → 즉시 가입 완료 → 모든 서비스 이용 가능
```

## 백엔드 변경 사항

### 1. 모델 변경 (models.py)
```python
class User(Base):
    id = Column(Integer, primary_key=True)
    nickname = Column(String(50), unique=True, nullable=False)
    invite_code = Column(String(6), nullable=False)
    rank = Column(String(20), default="STANDARD")  # VIP, PREMIUM, STANDARD
    cyber_token_balance = Column(Integer, default=200)
    created_at = Column(DateTime, default=datetime.utcnow)
```

### 2. 단순 인증 시스템 (auth/simple_auth.py)
- JWT 완전 제거
- 초대코드 검증
- 랭크 기반 접근 제어

### 3. API 엔드포인트 (routers/auth_simple.py)
- `POST /auth/register`: 초대코드로 가입
- `POST /auth/invite-codes`: 관리자용 초대코드 생성
- `GET /auth/users/{nickname}`: 사용자 조회

## 프론트엔드 변경 사항

### 1. 초대코드 가입 컴포넌트
- `components/auth/InviteCodeRegister.tsx`
- 직관적인 초대코드 입력 UI
- 데모용 초대코드 제공

### 2. 사용자 상태 관리
- `hooks/useUser.tsx`
- 로컬스토리지 기반 단순 인증
- 랭크별 권한 체크

### 3. 제거된 기능
- 나이 인증 로직
- 복잡한 가입 절차
- JWT 토큰 관리
- 이메일/비밀번호 인증

## 랭크 시스템

### 랭크 계층
1. **STANDARD** (기본): 기본 서비스 이용
2. **PREMIUM**: 프리미엄 콘텐츠 접근
3. **VIP**: 모든 VIP 서비스 접근

### 접근 제어
```python
def check_rank_access(user_rank: str, required_rank: str) -> bool:
    rank_hierarchy = {"VIP": 3, "PREMIUM": 2, "STANDARD": 1}
    return rank_hierarchy[user_rank] >= rank_hierarchy[required_rank]
```

## 데모용 초대코드

- `VIP2024`: VIP 등급
- `DEMO99`: PREMIUM 등급  
- `TEST01`: STANDARD 등급

## 마이그레이션 가이드

### 데이터베이스
1. `UserSegment`, `AgeVerificationRecord` 테이블 제거
2. `User` 테이블에 `rank` 컬럼 추가
3. `AdultContent` 테이블의 `required_segment_level` → `required_rank` 변경

### 코드
1. JWT 관련 코드 제거
2. 나이 인증 로직 제거
3. 랭크 기반 접근 제어로 교체

이제 사용자는 초대코드만으로 즉시 가입하고 모든 서비스를 이용할 수 있습니다!

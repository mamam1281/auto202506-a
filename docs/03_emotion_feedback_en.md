3.1. Purpose & Overview
Goal:

ì‚¬ìš©ì í–‰ë™ì„ ê¸°ë°˜ìœ¼ë¡œ ê°ì • ìƒíƒœ(ë„íŒŒë¯¼ ë¶„ë¹„ ê²½ë¡œ)ë¥¼ ê°ì§€í•˜ê³ ,

ì¦‰ê°ì ì´ê³  ì‹¬ë¦¬ì ìœ¼ë¡œ ìê·¹ì ì¸ í”¼ë“œë°±(ì• ë‹ˆë©”ì´ì…˜, ì‚¬ìš´ë“œ, ì‚¬ì´ë²„ í† í° ë³´ìƒ)ì„ ì œê³µí•˜ì—¬

â€œí–‰ìœ„ì¤‘ë… íŠ¸ë¦¬ê±°(Variableâ€Ratio Reward + Social Feedback)â€ì™€ â€œë„íŒŒë¯¼ ë£¨í”„â€ë¥¼ ê·¹ëŒ€í™”

ê¶ê·¹ì ìœ¼ë¡œ ë³¸ì‚¬ ì‚¬ì´íŠ¸ì—ì„œ íšë“í•œ ì‚¬ì´ë²„ í† í°ì„ ì•± ë‚´ ì†Œë¹„ë¡œ ì—°ê²°í•˜ê³ , ì•±ì—ì„œ ë¶€ì¡± ì‹œ ë‹¤ì‹œ ë³¸ì‚¬ë¡œ ìœ ë„í•˜ë©° ë¦¬í…ì…˜ì„ ê°•í™”í•¨.

í•µì‹¬ í¬ì¸íŠ¸
ì¦‰ê° í”¼ë“œë°±(Immediate Feedback):

ê²Œì„ ê²°ê³¼ ì§í›„ ì• ë‹ˆë©”ì´ì…˜ + ì‚¬ìš´ë“œ + í† í° ë³´ìƒ íŒ¨í‚¤ì§€

ì¬ë¯¸ ìš”ì†Œ(ì‹œê°Â·ì²­ê°)ì™€ **ì‚¬ì´ë²„ í† í° ì¦‰ì‹œ íšë“(ë˜ëŠ” ê°ì†Œ)**ë¥¼ ê²°í•©í•˜ì—¬ ì‚¬ìš©ìì˜ ë„íŒŒë¯¼ ë¶„ë¹„ë¥¼ ìœ ë°œ

í–‰ìœ„ì¤‘ë… íŠ¸ë¦¬ê±°(Behavioral Addiction Triggers):

Variableâ€Ratio Reward Schedule: ìŠ¬ë¡¯, ë£°ë ›, ê°€ì±  ë“±ì—ì„œ â€œì–¸ì œ ë‹¹ì²¨ë ì§€ ëª¨ë¦„â€ ê¸´ì¥ê°

Social Proof / Leaderboard: ì‹¤ì‹œê°„ ë­í‚¹ â†’ ê²½ìŸì‹¬ ìê·¹

Limited-Time Offer / Flash Event: â€œë³¸ì‚¬ ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ì´ 2ì‹œê°„ í›„ì— ì¢…ë£Œë©ë‹ˆë‹¤ â†’ 100í† í° ë³´ë„ˆìŠ¤â€

ì‚¬ì´ë²„ í† í° ì—°ê³„:

ë³¸ì‚¬ ì‚¬ì´íŠ¸ ì´ìš© ì‹œ íšë“ â†’ Redisì— user:{id}:cyber_token_balance ì €ì¥

ì•± ë‚´ ê²Œì„Â·ì–¸ë½ ì‹œ ì‚¬ìš© â†’ í† í° ì”ê³  ê°ì†Œ

ì”ê³  ë¶€ì¡± ì‹œ ë³¸ì‚¬ ì‚¬ì´íŠ¸ë¡œ ì¦‰ì‹œ ìœ ë„ (ë¦¬ë””ë ‰ì…˜ / í‘¸ì‹œ ì•Œë¦¼)

3.2. Emotion Matrix & Feedback Triggers
Action Type	Emotion Trigger	Reward Behavior	Feedback Message & Asset
GAME_WIN	Dopamine Surge	+10~50 ì‚¬ì´ë²„ í† í°(ëœë¤) + í™”ë ¤í•œ ì• ë‹ˆë©”ì´ì…˜	â€œğŸ‰ ëŒ€ë°•! {earned_tokens} í† í° íšë“! ê³ ìŠ¤í”¼ë“œ í”Œë ˆì´ ê³„ì†!â€
(Confetti ì• ë‹ˆë©”ì´ì…˜ + Victory ì‚¬ìš´ë“œ)
GAME_FAIL	Frustration Loop	â€“2 ì‚¬ì´ë²„ í† í°(ì‘ì€ íŒ¨ë„í‹°) + ê²©ë ¤ ì• ë‹ˆë©”ì´ì…˜	â€œğŸ˜“ ì•„ì‰½ë„¤ìš”â€¦ í•˜ì§€ë§Œ ê³§ ë³´ìƒì„ ë‹¤ì‹œ ë°›ì„ ìˆ˜ ìˆì–´ìš”!â€
(Sad Shake ì• ë‹ˆë©”ì´ì…˜ + Encourage ì‚¬ìš´ë“œ)
GAME_RETRY	Determination Boost	â€“1 ì‚¬ì´ë²„ í† í°(ì¬ë„ì „ ë¹„ìš©) + ì§§ì€ â€œë‹¤ì‹œ ë„ì „â€ ì• ë‹ˆë©”ì´ì…˜	â€œğŸ”¥ í•œ ë²ˆ ë”? ì´ë²ˆì—” í™•ë¥ ì´ 15% ìƒìŠ¹í–ˆì–´ìš”!â€
(Flash ì• ë‹ˆë©”ì´ì…˜ + Beat ì‚¬ìš´ë“œ)
DAILY_INACTIVE (>12h)	Concern	í‘¸ì‹œ ì•Œë¦¼ â†’ ë³¸ì‚¬ ì‚¬ì´íŠ¸ì—ì„œ +100 í† í° ë³´ìƒ ì œì•ˆ	â€œâŒ› ì˜¤ëœë§Œì´ë„¤ìš”! ë³¸ì‚¬ ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ë§Œ í•´ë„ 100í† í° ë“œë ¤ìš”!â€
(Ring í†¤ + í† í° ì´ë¯¸ì§€ ì• ë‹ˆë©”ì´ì…˜)
REWARD_CLAIM	Satisfaction	+ ì¼ì •ëŸ‰ ì‚¬ì´ë²„ í† í°(ì½˜í…ì¸  ì–¸ë½ ë³´ë„ˆìŠ¤)	â€œğŸ‘ ë³´ìƒ íšë“! {item_name} ì–¸ë½ ì™„ë£Œ. ë‹¤ìŒ ë³´ìƒê¹Œì§€ {next_threshold}í† í° ë‚¨ìŒâ€
(Unlock ì• ë‹ˆë©”ì´ì…˜ + Cheer ì‚¬ìš´ë“œ)
QUIZ_COMPLETE	Curiosity/Engagement	+200 í† í°(ë³¸ì‚¬ ì‚¬ì´íŠ¸ í€´ì¦ˆ) + ë¦¬ìŠ¤í¬ í”„ë¡œí•„ ë°˜ì˜	â€œğŸ§  í€´ì¦ˆ ì™„ë£Œ! ë‹¹ì‹ ì€ {risk_profile}í˜• í”Œë ˆì´ì–´êµ°ìš”. ë§ì¶¤ ë¦¬ì›Œë“œë¥¼ ì¶”ì²œí•´ë“œë¦´ê²Œìš”!â€

Note: ê° ìƒí™©ë³„ë¡œ â€œì• ë‹ˆë©”ì´ì…˜+ì‚¬ìš´ë“œ+í† í° ì¦ê°â€ íŒ¨í‚¤ì§€ê°€ í•œ ì„¸íŠ¸ë¡œ ë¬¶ì—¬, ìœ ì €ì˜ ê°ì • ìƒíƒœ(ë„íŒŒë¯¼ ë¶„ë¹„)ì™€ ì§ê²°ë˜ë„ë¡ ì„¤ê³„.

3.3. FastAPI Endpoint Integration
3.3.1. Emotion Feedback ì—”ë“œí¬ì¸íŠ¸
python
ë³µì‚¬
í¸ì§‘
from fastapi import FastAPI, HTTPException, Depends
from .database import get_db, get_redis
from .schemas import FeedbackRequest, FeedbackResponse
from .models import User
from datetime import datetime
import random

app = FastAPI()

# Emotion Matrix ì •ì˜ (ì‚¬ì´ë²„ í† í° ë³€í™”ëŸ‰, ê°ì • ë©”ì‹œì§€, ì• ë‹ˆë©”ì´ì…˜ íƒœê·¸, ì‚¬ìš´ë“œ íƒœê·¸ í¬í•¨)
emotion_matrix = {
    "GAME_WIN": {
      "emotion": "happiness",
      "message": "ğŸ‰ ëŒ€ë°•! {earned_tokens} í† í° íšë“! ê³ ìŠ¤í”¼ë“œ í”Œë ˆì´ ê³„ì†!",
      "token_delta": lambda streak: random.randint(10, 50) + min(streak*2, 20),
      "animation": "confetti",
      "sound": "victory.mp3"
    },
    "GAME_FAIL": {
      "emotion": "frustration",
      "message": "ğŸ˜“ ì•„ì‰½ë„¤ìš”â€¦ í•˜ì§€ë§Œ ê³§ ë³´ìƒì„ ë‹¤ì‹œ ë°›ì„ ìˆ˜ ìˆì–´ìš”!",
      "token_delta": -2,
      "animation": "shake_sad",
      "sound": "encourage.mp3"
    },
    "GAME_RETRY": {
      "emotion": "determination",
      "message": "ğŸ”¥ í•œ ë²ˆ ë”? ì´ë²ˆì—” í™•ë¥ ì´ 15% ìƒìŠ¹í–ˆì–´ìš”!",
      "token_delta": -1,
      "animation": "flash",
      "sound": "beat.mp3"
    },
    "DAILY_INACTIVE": {
      "emotion": "concern",
      "message": "âŒ› ì˜¤ëœë§Œì´ë„¤ìš”! ë³¸ì‚¬ ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ë§Œ í•´ë„ 100í† í° ë“œë ¤ìš”!",
      "token_delta": 0,  # ì‹¤ì œ í† í°ì€ ë³¸ì‚¬ ì‚¬ì´íŠ¸ ì—°ë™ ì‹œ ì§€ê¸‰
      "animation": "token_rain",
      "sound": "ring.mp3"
    },
    "REWARD_CLAIM": {
      "emotion": "satisfaction",
      "message": "ğŸ‘ ë³´ìƒ íšë“! {item_name} ì–¸ë½ ì™„ë£Œ. ë‹¤ìŒ ë³´ìƒê¹Œì§€ {next_threshold}í† í° ë‚¨ìŒ",
      "token_delta": 0,  # ì´ë¯¸ ì§€ê¸‰ëœ ë³´ìƒ
      "animation": "unlock",
      "sound": "cheer.mp3"
    },
    "QUIZ_COMPLETE": {
      "emotion": "curiosity",
      "message": "ğŸ§  í€´ì¦ˆ ì™„ë£Œ! ë‹¹ì‹ ì€ {risk_profile}í˜• í”Œë ˆì´ì–´êµ°ìš”. ë§ì¶¤ ë¦¬ì›Œë“œë¥¼ ì¶”ì²œí•´ë“œë¦´ê²Œìš”!",
      "token_delta": 200,
      "animation": "quiz_success",
      "sound": "think.mp3"
    }
}

@app.post("/api/feedback", response_model=FeedbackResponse)
def get_feedback(req: FeedbackRequest, db=Depends(get_db), redis=Depends(get_redis)):
    user = db.query(User).filter(User.id == req.user_id).first()
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    
    entry = emotion_matrix.get(req.action_type)
    if not entry:
        # ê¸°ë³¸ í”¼ë“œë°±
        return {"emotion": "neutral", "message": "ê³„ì† ì§„í–‰í•´ë³´ì„¸ìš”!", "animation": None, "sound": None, "token_delta": 0}
    
    # í† í° ì¦ê° ê³„ì‚°
    if callable(entry["token_delta"]):
        # ì—°ìŠ¹/ì—°íŒ¨ ë“± streakë¥¼ ê³ ë ¤
        streak = int(redis.get(f"user:{req.user_id}:streak_count") or 0)
        token_change = entry["token_delta"](streak)
    else:
        token_change = entry["token_delta"]
    
    # í† í° ì”ê³  ì—…ë°ì´íŠ¸
    if token_change != 0:
        redis.incrby(f"user:{req.user_id}:cyber_token_balance", token_change)
    
    # ë©”ì‹œì§€ í¬ë§·íŒ…
    formatted_message = entry["message"].format(
        earned_tokens=token_change if token_change > 0 else 0,
        item_name=req.metadata.get("item_name", ""),
        next_threshold=req.metadata.get("next_threshold", "")
    )
    
    # ë§ˆì§€ë§‰ ì•¡ì…˜ ì‹œê° ì—…ë°ì´íŠ¸
    redis.set(f"user:{req.user_id}:last_action_ts", int(datetime.utcnow().timestamp()))
    
    return {
        "emotion": entry["emotion"],
        "message": formatted_message,
        "animation": entry["animation"],
        "sound": entry["sound"],
        "token_delta": token_change
    }
FeedbackResponse ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ:

python
ë³µì‚¬
í¸ì§‘
from pydantic import BaseModel
from typing import Optional

class FeedbackRequest(BaseModel):
    user_id: int
    action_type: str
    metadata: dict = {}

class FeedbackResponse(BaseModel):
    emotion: str              # happiness, frustration, determination ë“±
    message: str              # ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ í…ìŠ¤íŠ¸
    animation: Optional[str]  # confetti, shake_sad ë“±
    sound: Optional[str]      # victory.mp3, encourage.mp3 ë“±
    token_delta: int          # +/- ë³€í™”ëœ í† í° ìˆ˜ëŸ‰
ì ìš© íë¦„:

ìœ ì €ê°€ ìŠ¬ë¡¯Â·ë£°ë ›Â·í€´ì¦ˆ ë“± ì£¼ìš” í–‰ë™ì„ ì™„ë£Œ

í”„ë¡ íŠ¸ì—ì„œ /api/feedback í˜¸ì¶œ â†’ ìœ„ ë¡œì§ ì‹¤í–‰

ì‘ë‹µìœ¼ë¡œ ë°›ì€ animation/sound â†’ ì¦‰ì‹œ ì¬ìƒ, token_delta ì •ë³´ë¡œ í† í° UI ê°±ì‹ 

3.4. Frontend Integration (React ì˜ˆì‹œ)
3.4.1. useEmotionFeedback Hook
jsx
ë³µì‚¬
í¸ì§‘
import axios from "axios";

export async function fetchEmotionFeedback(userId, actionType, metadata = {}) {
  const response = await axios.post("/api/feedback", {
    user_id: userId,
    action_type: actionType,
    metadata: metadata
  });
  return response.data; // { emotion, message, animation, sound, token_delta }
}
3.4.2. SlotMachine ì»´í¬ë„ŒíŠ¸ ìˆ˜ì • ì˜ˆì‹œ
jsx
ë³µì‚¬
í¸ì§‘
import React, { useState, useEffect } from "react";
import { fetchEmotionFeedback } from "../hooks/useEmotionFeedback";
import useSound from "use-sound";
import Confetti from "react-confetti"; // ì˜ˆì‹œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
import { useSelector, useDispatch } from "react-redux";

function SlotMachine({ userId }) {
  const [reels, setReels] = useState([0, 0, 0]);
  const [streakCount, setStreakCount] = useState(0);
  const [feedback, setFeedback] = useState(null);
  const [tokenBalance, setTokenBalance] = useState(0);

  // Redux ë˜ëŠ” Contextë¡œë¶€í„° ì‚¬ì´ë²„ í† í° ì”ê³  êµ¬ë…
  const balance = useSelector(state => state.user.cyberTokenBalance);
  const dispatch = useDispatch();

  // ì‚¬ìš´ë“œ ì¤€ë¹„
  const [playVictory] = useSound("/sounds/victory.mp3");
  const [playEncourage] = useSound("/sounds/encourage.mp3");

  useEffect(() => {
    // ì´ˆê¸° í† í° ì”ê³  ë¡œë“œ
    setTokenBalance(balance);
  }, [balance]);

  const spin = async () => {
    // 1) ì‹¤ì œ ìŠ¹ë¦¬ íŒì • ë¡œì§ (variable-ratio ê¸°ë°˜)
    const isWin = Math.random() < (0.10 + Math.min(streakCount * 0.01, 0.30));
    const actionType = isWin ? "GAME_WIN" : "GAME_FAIL";
    const metadata = {}; // ì¶”í›„ í•„ìš”í•œ ë©”íƒ€ë°ì´í„° ì¶”ê°€

    // 2) emotion feedback ìš”ì²­
    const data = await fetchEmotionFeedback(userId, actionType, metadata);
    setFeedback(data);

    // 3) ì• ë‹ˆë©”ì´ì…˜ & ì‚¬ìš´ë“œ
    if (data.animation === "confetti") {
      // Confetti ì• ë‹ˆë©”ì´ì…˜ ë…¸ì¶œ
      // ì˜ˆ: <Confetti numberOfPieces={200} />
      playVictory();
    } else if (data.animation === "shake_sad") {
      playEncourage();
      // í™”ë©´ í”ë“¤ê¸° ë“±ì˜ ì¶”ê°€ ì´í™íŠ¸ ì²˜ë¦¬
    }

    // 4) ë ˆì¼ì¦ˆ(ë¦¬ë•ìŠ¤) í† í° ì”ê³  ì—…ë°ì´íŠ¸
    if (data.token_delta !== 0) {
      dispatch({ type: "UPDATE_TOKEN_BALANCE", payload: data.token_delta });
    }

    // 5) ìŠ¤íŠ¸ë¦­(streak) ê´€ë¦¬
    if (isWin) {
      setStreakCount(prev => prev + 1);
      dispatch({ type: "UPDATE_STREAK", payload: streakCount + 1 });
    } else {
      setStreakCount(0);
      dispatch({ type: "UPDATE_STREAK", payload: 0 });
    }

    // 6) ë¦¬ì½¤ë³´ ì‹ í˜¸: ë‹¤ìŒ ì•¡ì…˜ ì˜ˆê³  (ex: GAME_RETRY ê¶Œì¥)
    if (!isWin && streakCount >= 2) {
      const retryFeedback = await fetchEmotionFeedback(userId, "GAME_RETRY", {});
      // í™”ë©´ì— â€œí•œ ë²ˆ ë”â€ í† ìŠ¤íŠ¸ ë…¸ì¶œ
      setFeedback(retryFeedback);
      playEncourage();
      dispatch({ type: "UPDATE_TOKEN_BALANCE", payload: retryFeedback.token_delta });
    }

    // 7) ë¦´ ì¶œë ¥ (0~9 ëœë¤)
    setReels([
      Math.floor(Math.random() * 10),
      Math.floor(Math.random() * 10),
      Math.floor(Math.random() * 10),
    ]);
  };

  return (
    <div>
      <h2>Slot Machine</h2>
      <div className="reels">
        {reels.map((num, idx) => (
          <div key={idx} className="reel">{num}</div>
        ))}
      </div>
      <button onClick={spin}>Spin</button>
      {feedback && (
        <div className={`feedback ${feedback.emotion}`}>
          {feedback.message}
        </div>
      )}
      <div>Streak: {streakCount}</div>
      <div>Cyber Token Balance: {tokenBalance}</div>
    </div>
  );
}

export default SlotMachine;
ì£¼ìš” íŠ¹ì§•:

GAME_WIN ì‹œ â€œë„íŒŒë¯¼ ì„œì§€â€ íŠ¸ë¦¬ê±° â†’ í™”ë ¤í•œ ì½˜í˜í‹° + í† í° ë³´ìƒ

GAME_FAIL ì‹œ â€œì¢Œì ˆ â†’ ì¬ë„ì „â€ ë£¨í”„ í™œì„±í™” â†’ ì†ŒëŸ‰ í† í° ì°¨ê° í›„ â€œí•œ ë²ˆ ë”â€ ìœ ë„

ë¦¬ë•ìŠ¤/ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ìš©í•´ ì‚¬ì´ë²„ í† í° ì”ê³ ì™€ ìŠ¤íŠ¸ë¦­ ì¹´ìš´íŠ¸ë¥¼ ì „ì—­ ê´€ë¦¬

3.5. Psychometric/Survey í”¼ë“œë°± ì—°ë™
í€´ì¦ˆ ì™„ë£Œ(Quiz Complete) ì‹œ /api/feedback í˜¸ì¶œ â†’ QUIZ_COMPLETE

ë¦¬ìŠ¤í¬ í”„ë¡œí•„ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ í”¼ë“œë°± ë©”ì‹œì§€ + +200 í† í° ë³´ìƒ

ë„íŒŒë¯¼ í”¼ë“œë°±: ì• ë‹ˆë©”ì´ì…˜ â€œquiz_successâ€ + (think.mp3) ì‚¬ìš´ë“œ

ì´í›„ ê°œì¸í™” ì¶”ì²œ (02 ë¬¸ì„œì˜ Recommendation Engine)ì—ì„œ risk_profile í™œìš©

3.6. ìš”ì•½
ìœ ì € í–‰ë™ â†’ FastAPI /api/feedback í˜¸ì¶œ â†’

ë„íŒŒë¯¼ ë£¨í”„(ì• ë‹ˆë©”ì´ì…˜ + ì‚¬ìš´ë“œ + í† í° ì¦ê°) í™œì„±í™” â†’

ì‚¬ì´ë²„ í† í° ì”ê³ ê°€ ë³€ë™ë˜ë©´ ì¦‰ì‹œ Redux/Redis â†’ UI ì—…ë°ì´íŠ¸ â†’

ì”ê³  ë¶€ì¡± ì‹œ ë³¸ì‚¬ ì‚¬ì´íŠ¸ ë¦¬ë””ë ‰ì…˜ â†’ ë¦¬í…ì…˜ ê³ ë¦¬ ì™„ì„±

<!-- English translation below -->

# Emotion Feedback (English Translation)

3.1. Purpose & Overview
Goal:

To detect emotional states (dopamine secretion pathways) based on user behavior, and

To provide immediate and psychologically stimulating feedback (animations, sounds, cyber token rewards) to maximize

"Behavioral Addiction Triggers (Variable-Ratio Reward + Social Feedback)" and "Dopamine Loops"

Ultimately, to connect the cyber tokens acquired on the headquarters site to consumption within the app, and to redirect to the headquarters when lacking in the app, thereby strengthening retention.

Key Points
Immediate Feedback:

Animation + Sound + Token Reward Package immediately after game results

Combining fun elements (visual and auditory) with **immediate acquisition (or reduction) of cyber tokens** to induce dopamine secretion in users

Behavioral Addiction Triggers:

Variable-Ratio Reward Schedule: Uncertainty of "when will I win" in slots, roulette, gacha, etc.

Social Proof / Leaderboard: Real-time rankings â†’ Stimulate competitiveness

Limited-Time Offer / Flash Event: "Headquarters site login ends in 2 hours â†’ 100 token bonus"

Linkage with Cyber Tokens:

Acquired when using the headquarters site â†’ Stored in Redis as user:{id}:cyber_token_balance

Used in-app games/unlocks â†’ Decrease in token balance

Immediate guidance to the headquarters site when the balance is insufficient (redirection/push notification)

3.2. Emotion Matrix & Feedback Triggers
Action Type	Emotion Trigger	Reward Behavior	Feedback Message & Asset
GAME_WIN	Dopamine Surge	+10~50 ì‚¬ì´ë²„ í† í°(ëœë¤) + í™”ë ¤í•œ ì• ë‹ˆë©”ì´ì…˜	â€œğŸ‰ ëŒ€ë°•! {earned_tokens} í† í° íšë“! ê³ ìŠ¤í”¼ë“œ í”Œë ˆì´ ê³„ì†!â€
(Confetti ì• ë‹ˆë©”ì´ì…˜ + Victory ì‚¬ìš´ë“œ)
GAME_FAIL	Frustration Loop	â€“2 ì‚¬ì´ë²„ í† í°(ì‘ì€ íŒ¨ë„í‹°) + ê²©ë ¤ ì• ë‹ˆë©”ì´ì…˜	â€œğŸ˜“ ì•„ì‰½ë„¤ìš”â€¦ í•˜ì§€ë§Œ ê³§ ë³´ìƒì„ ë‹¤ì‹œ ë°›ì„ ìˆ˜ ìˆì–´ìš”!â€
(Sad Shake ì• ë‹ˆë©”ì´ì…˜ + Encourage ì‚¬ìš´ë“œ)
GAME_RETRY	Determination Boost	â€“1 ì‚¬ì´ë²„ í† í°(ì¬ë„ì „ ë¹„ìš©) + ì§§ì€ â€œë‹¤ì‹œ ë„ì „â€ ì• ë‹ˆë©”ì´ì…˜	â€œğŸ”¥ í•œ ë²ˆ ë”? ì´ë²ˆì—” í™•ë¥ ì´ 15% ìƒìŠ¹í–ˆì–´ìš”!â€
(Flash ì• ë‹ˆë©”ì´ì…˜ + Beat ì‚¬ìš´ë“œ)
DAILY_INACTIVE (>12h)	Concern	í‘¸ì‹œ ì•Œë¦¼ â†’ ë³¸ì‚¬ ì‚¬ì´íŠ¸ì—ì„œ +100 í† í° ë³´ìƒ ì œì•ˆ	â€œâŒ› ì˜¤ëœë§Œì´ë„¤ìš”! ë³¸ì‚¬ ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ë§Œ í•´ë„ 100í† í° ë“œë ¤ìš”!â€
(Ring í†¤ + í† í° ì´ë¯¸ì§€ ì• ë‹ˆë©”ì´ì…˜)
REWARD_CLAIM	Satisfaction	+ ì¼ì •ëŸ‰ ì‚¬ì´ë²„ í† í°(ì½˜í…ì¸  ì–¸ë½ ë³´ë„ˆìŠ¤)	â€œğŸ‘ ë³´ìƒ íšë“! {item_name} ì–¸ë½ ì™„ë£Œ. ë‹¤ìŒ ë³´ìƒê¹Œì§€ {next_threshold}í† í° ë‚¨ìŒâ€
(Unlock ì• ë‹ˆë©”ì´ì…˜ + Cheer ì‚¬ìš´ë“œ)
QUIZ_COMPLETE	Curiosity/Engagement	+200 í† í°(ë³¸ì‚¬ ì‚¬ì´íŠ¸ í€´ì¦ˆ) + ë¦¬ìŠ¤í¬ í”„ë¡œí•„ ë°˜ì˜	â€œğŸ§  í€´ì¦ˆ ì™„ë£Œ! ë‹¹ì‹ ì€ {risk_profile}í˜• í”Œë ˆì´ì–´êµ°ìš”. ë§ì¶¤ ë¦¬ì›Œë“œë¥¼ ì¶”ì²œí•´ë“œë¦´ê²Œìš”!â€

Note: Each situation is designed as a set of "Animation + Sound + Token Change" packages, directly linked to the user's emotional state (dopamine secretion).

3.3. FastAPI Endpoint Integration
3.3.1. Emotion Feedback Endpoint
python
Copy
Edit
from fastapi import FastAPI, HTTPException, Depends
from .database import get_db, get_redis
from .schemas import FeedbackRequest, FeedbackResponse
from .models import User
from datetime import datetime
import random

app = FastAPI()

# Define Emotion Matrix (including changes in cyber token, emotional message, animation tag, sound tag)
emotion_matrix = {
    "GAME_WIN": {
      "emotion": "happiness",
      "message": "ğŸ‰ ëŒ€ë°•! {earned_tokens} í† í° íšë“! ê³ ìŠ¤í”¼ë“œ í”Œë ˆì´ ê³„ì†!",
      "token_delta": lambda streak: random.randint(10, 50) + min(streak*2, 20),
      "animation": "confetti",
      "sound": "victory.mp3"
    },
    "GAME_FAIL": {
      "emotion": "frustration",
      "message": "ğŸ˜“ ì•„ì‰½ë„¤ìš”â€¦ í•˜ì§€ë§Œ ê³§ ë³´ìƒì„ ë‹¤ì‹œ ë°›ì„ ìˆ˜ ìˆì–´ìš”!",
      "token_delta": -2,
      "animation": "shake_sad",
      "sound": "encourage.mp3"
    },
    "GAME_RETRY": {
      "emotion": "determination",
      "message": "ğŸ”¥ í•œ ë²ˆ ë”? ì´ë²ˆì—” í™•ë¥ ì´ 15% ìƒìŠ¹í–ˆì–´ìš”!",
      "token_delta": -1,
      "animation": "flash",
      "sound": "beat.mp3"
    },
    "DAILY_INACTIVE": {
      "emotion": "concern",
      "message": "âŒ› ì˜¤ëœë§Œì´ë„¤ìš”! ë³¸ì‚¬ ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ë§Œ í•´ë„ 100í† í° ë“œë ¤ìš”!",
      "token_delta": 0,  # Actual tokens granted when linked with the headquarters site
      "animation": "token_rain",
      "sound": "ring.mp3"
    },
    "REWARD_CLAIM": {
      "emotion": "satisfaction",
      "message": "ğŸ‘ ë³´ìƒ íšë“! {item_name} ì–¸ë½ ì™„ë£Œ. ë‹¤ìŒ ë³´ìƒê¹Œì§€ {next_threshold}í† í° ë‚¨ìŒ",
      "token_delta": 0,  # Already granted rewards
      "animation": "unlock",
      "sound": "cheer.mp3"
    },
    "QUIZ_COMPLETE": {
      "emotion": "curiosity",
      "message": "ğŸ§  í€´ì¦ˆ ì™„ë£Œ! ë‹¹ì‹ ì€ {risk_profile}í˜• í”Œë ˆì´ì–´êµ°ìš”. ë§ì¶¤ ë¦¬ì›Œë“œë¥¼ ì¶”ì²œí•´ë“œë¦´ê²Œìš”!",
      "token_delta": 200,
      "animation": "quiz_success",
      "sound": "think.mp3"
    }
}

@app.post("/api/feedback", response_model=FeedbackResponse)
def get_feedback(req: FeedbackRequest, db=Depends(get_db), redis=Depends(get_redis)):
    user = db.query(User).filter(User.id == req.user_id).first()
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    
    entry = emotion_matrix.get(req.action_type)
    if not entry:
        # Default feedback
        return {"emotion": "neutral", "message": "ê³„ì† ì§„í–‰í•´ë³´ì„¸ìš”!", "animation": None, "sound": None, "token_delta": 0}
    
    # Calculate token change
    if callable(entry["token_delta"]):
        # Considering streaks like winning/losing streaks
        streak = int(redis.get(f"user:{req.user_id}:streak_count") or 0)
        token_change = entry["token_delta"](streak)
    else:
        token_change = entry["token_delta"]
    
    # Update token balance
    if token_change != 0:
        redis.incrby(f"user:{req.user_id}:cyber_token_balance", token_change)
    
    # Format message
    formatted_message = entry["message"].format(
        earned_tokens=token_change if token_change > 0 else 0,
        item_name=req.metadata.get("item_name", ""),
        next_threshold=req.metadata.get("next_threshold", "")
    )
    
    # Update last action timestamp
    redis.set(f"user:{req.user_id}:last_action_ts", int(datetime.utcnow().timestamp()))
    
    return {
        "emotion": entry["emotion"],
        "message": formatted_message,
        "animation": entry["animation"],
        "sound": entry["sound"],
        "token_delta": token_change
    }
Example of FeedbackResponse schema:

python
Copy
Edit
from pydantic import BaseModel
from typing import Optional

class FeedbackRequest(BaseModel):
    user_id: int
    action_type: str
    metadata: dict = {}

class FeedbackResponse(BaseModel):
    emotion: str              # happiness, frustration, determination, etc.
    message: str              # Text to be displayed to the user
    animation: Optional[str]  # confetti, shake_sad, etc.
    sound: Optional[str]      # victory.mp3, encourage.mp3, etc.
    token_delta: int          # +/- Changed amount of tokens
Application Flow:

The user completes main actions like slots, roulette, quizzes

The front calls /api/feedback â†’ Executes the above logic

Received animation/sound in response â†’ Immediate playback, token_delta information updates the token UI

3.4. Frontend Integration (React Example)
3.4.1. useEmotionFeedback Hook
jsx
Copy
Edit
import axios from "axios";

export async function fetchEmotionFeedback(userId, actionType, metadata = {}) {
  const response = await axios.post("/api/feedback", {
    user_id: userId,
    action_type: actionType,
    metadata: metadata
  });
  return response.data; // { emotion, message, animation, sound, token_delta }
}
3.4.2. SlotMachine Component Modification Example
jsx
Copy
Edit
import React, { useState, useEffect } from "react";
import { fetchEmotionFeedback } from "../hooks/useEmotionFeedback";
import useSound from "use-sound";
import Confetti from "react-confetti"; // A library that can be used as an example
import { useSelector, useDispatch } from "react-redux";

function SlotMachine({ userId }) {
  const [reels, setReels] = useState([0, 0, 0]);
  const [streakCount, setStreakCount] = useState(0);
  const [feedback, setFeedback] = useState(null);
  const [tokenBalance, setTokenBalance] = useState(0);

  // Subscribe to cyber token balance from Redux or Context
  const balance = useSelector(state => state.user.cyberTokenBalance);
  const dispatch = useDispatch();

  // Prepare sounds
  const [playVictory] = useSound("/sounds/victory.mp3");
  const [playEncourage] = useSound("/sounds/encourage.mp3");

  useEffect(() => {
    // Load initial token balance
    setTokenBalance(balance);
  }, [balance]);

  const spin = async () => {
    // 1) Actual win judgment logic (based on variable-ratio)
    const isWin = Math.random() < (0.10 + Math.min(streakCount * 0.01, 0.30));
    const actionType = isWin ? "GAME_WIN" : "GAME_FAIL";
    const metadata = {}; // Add necessary metadata later

    // 2) Request emotion feedback
    const data = await fetchEmotionFeedback(userId, actionType, metadata);
    setFeedback(data);

    // 3) Animation & Sound
    if (data.animation === "confetti") {
      // Show Confetti animation
      // Example: <Confetti numberOfPieces={200} />
      playVictory();
    } else if (data.animation === "shake_sad") {
      playEncourage();
      // Additional effects like shaking the screen
    }

    // 4) Update Redux token balance
    if (data.token_delta !== 0) {
      dispatch({ type: "UPDATE_TOKEN_BALANCE", payload: data.token_delta });
    }

    // 5) Manage streak
    if (isWin) {
      setStreakCount(prev => prev + 1);
      dispatch({ type: "UPDATE_STREAK", payload: streakCount + 1 });
    } else {
      setStreakCount(0);
      dispatch({ type: "UPDATE_STREAK", payload: 0 });
    }

    // 6) Recombu signal: Preview of the next action (e.g., recommend GAME_RETRY)
    if (!isWin && streakCount >= 2) {
      const retryFeedback = await fetchEmotionFeedback(userId, "GAME_RETRY", {});
      // Show "Try again" toast on the screen
      setFeedback(retryFeedback);
      playEncourage();
      dispatch({ type: "UPDATE_TOKEN_BALANCE", payload: retryFeedback.token_delta });
    }

    // 7) Output reels (random 0~9)
    setReels([
      Math.floor(Math.random() * 10),
      Math.floor(Math.random() * 10),
      Math.floor(Math.random() * 10),
    ]);
  };

  return (
    <div>
      <h2>Slot Machine</h2>
      <div className="reels">
        {reels.map((num, idx) => (
          <div key={idx} className="reel">{num}</div>
        ))}
      </div>
      <button onClick={spin}>Spin</button>
      {feedback && (
        <div className={`feedback ${feedback.emotion}`}>
          {feedback.message}
        </div>
      )}
      <div>Streak: {streakCount}</div>
      <div>Cyber Token Balance: {tokenBalance}</div>
    </div>
  );
}

export default SlotMachine;
Main Features:

Trigger "Dopamine Surge" with GAME_WIN â†’ Colorful confetti + Token reward

Activate "Frustration â†’ Retry" loop with GAME_FAIL â†’ Induce "Try again" after small token deduction

Globally manage cyber token balance and streak count using Redux/Context

3.5. Integration of Psychometric/Survey Feedback
Call /api/feedback on Quiz Complete â†’ QUIZ_COMPLETE

Feedback message based on risk profile + +200 token reward

Dopamine feedback: Animation "quiz_success" + Sound "think.mp3"

Utilize risk_profile in subsequent personalized recommendations (Recommendation Engine in Document 02)

3.6. Summary
User behavior â†’ FastAPI /api/feedback call â†’

Activate Dopamine Loop (Animation + Sound + Token Change) â†’

Immediately update UI via Redux/Redis when cyber token balance changes â†’

Redirect to headquarters site when balance is insufficient â†’ Complete the retention loop

